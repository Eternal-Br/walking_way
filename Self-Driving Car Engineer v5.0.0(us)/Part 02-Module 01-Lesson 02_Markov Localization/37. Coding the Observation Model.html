<!-- udacimak v1.4.4 -->
<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta content="ie=edge" http-equiv="X-UA-Compatible"/>
  <title>
   Coding the Observation Model
  </title>
  <link href="../assets/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="../assets/css/plyr.css" rel="stylesheet"/>
  <link href="../assets/css/katex.min.css" rel="stylesheet"/>
  <link href="../assets/css/jquery.mCustomScrollbar.min.css" rel="stylesheet"/>
  <link href="../assets/css/styles.css" rel="stylesheet"/>
  <link href="../assets/img/udacimak.png" rel="shortcut icon" type="image/png">
  </link>
 </head>
 <body>
  <div class="wrapper">
   <nav id="sidebar">
    <div class="sidebar-header">
     <h3>
      Markov Localization
     </h3>
    </div>
    <ul class="sidebar-list list-unstyled CTAs">
     <li>
      <a class="article" href="../index.html">
       Back to Home
      </a>
     </li>
    </ul>
    <ul class="sidebar-list list-unstyled components">
     <li class="">
      <a href="01. Return to Bayes' Rule.html">
       01. Return to Bayes' Rule
      </a>
     </li>
     <li class="">
      <a href="02. Overview.html">
       02. Overview
      </a>
     </li>
     <li class="">
      <a href="03. Localization Posterior Introduction.html">
       03. Localization Posterior: Introduction
      </a>
     </li>
     <li class="">
      <a href="04. Localization Posterior Explanation and Implementation.html">
       04. Localization Posterior Explanation and Implementation
      </a>
     </li>
     <li class="">
      <a href="05. Bayes' Rule.html">
       05. Bayes' Rule
      </a>
     </li>
     <li class="">
      <a href="06. Bayes' Filter For Localization.html">
       06. Bayes' Filter For Localization
      </a>
     </li>
     <li class="">
      <a href="07. Calculate Localization Posterior.html">
       07. Calculate Localization Posterior
      </a>
     </li>
     <li class="">
      <a href="08. Initialize Belief State.html">
       08. Initialize Belief State
      </a>
     </li>
     <li class="">
      <a href="09. Initialize Priors Function.html">
       09. Initialize Priors Function
      </a>
     </li>
     <li class="">
      <a href="10. Solution Initialize Priors Function.html">
       10. Solution: Initialize Priors Function
      </a>
     </li>
     <li class="">
      <a href="11. Quiz How Much Data.html">
       11. Quiz: How Much Data?
      </a>
     </li>
     <li class="">
      <a href="12. How Much Data Explanation.html">
       12. How Much Data: Explanation
      </a>
     </li>
     <li class="">
      <a href="13. Derivation Outline.html">
       13. Derivation Outline
      </a>
     </li>
     <li class="">
      <a href="14. Apply Bayes Rule with Additional Conditions.html">
       14. Apply Bayes Rule with Additional Conditions
      </a>
     </li>
     <li class="">
      <a href="15. Bayes Rule and Law of Total Probability.html">
       15. Bayes Rule and Law of Total Probability
      </a>
     </li>
     <li class="">
      <a href="16. Total Probability and Markov Assumption.html">
       16. Total Probability and Markov Assumption
      </a>
     </li>
     <li class="">
      <a href="17. Markov Assumption for Motion Model Quiz.html">
       17. Markov Assumption for Motion Model: Quiz
      </a>
     </li>
     <li class="">
      <a href="18. Markov Assumption for Motion Model Explanation.html">
       18. Markov Assumption for Motion Model: Explanation
      </a>
     </li>
     <li class="">
      <a href="19. After Applying Markov Assumption Quiz.html">
       19. After Applying Markov Assumption: Quiz
      </a>
     </li>
     <li class="">
      <a href="20. Recursive Structure.html">
       20. Recursive Structure
      </a>
     </li>
     <li class="">
      <a href="21. Lesson Breakpoint.html">
       21. Lesson Breakpoint
      </a>
     </li>
     <li class="">
      <a href="22. Implementation Details for Motion Model.html">
       22. Implementation Details for Motion Model
      </a>
     </li>
     <li class="">
      <a href="23. Noise in Motion Model Quiz.html">
       23. Noise in Motion Model: Quiz
      </a>
     </li>
     <li class="">
      <a href="24. Noise in Motion Model Solution.html">
       24. Noise in Motion Model: Solution
      </a>
     </li>
     <li class="">
      <a href="25. Determine Probabilities.html">
       25. Determine Probabilities
      </a>
     </li>
     <li class="">
      <a href="26. Motion Model Probabiity I.html">
       26. Motion Model Probabiity I
      </a>
     </li>
     <li class="">
      <a href="27. Motion Model Probability II.html">
       27. Motion Model Probability II
      </a>
     </li>
     <li class="">
      <a href="28. Coding the Motion Model.html">
       28. Coding the Motion Model
      </a>
     </li>
     <li class="">
      <a href="29. Solution Coding the Motion Model.html">
       29. Solution: Coding the Motion Model
      </a>
     </li>
     <li class="">
      <a href="30. Observation Model Introduction.html">
       30. Observation Model Introduction
      </a>
     </li>
     <li class="">
      <a href="31. Markov Assumption for Observation Model.html">
       31. Markov Assumption for Observation Model
      </a>
     </li>
     <li class="">
      <a href="32. Finalize the Bayes Localization Filter.html">
       32. Finalize the Bayes Localization Filter
      </a>
     </li>
     <li class="">
      <a href="33. Bayes Filter Theory Summary.html">
       33. Bayes Filter Theory Summary
      </a>
     </li>
     <li class="">
      <a href="34. Observation Model Probability.html">
       34. Observation Model Probability
      </a>
     </li>
     <li class="">
      <a href="35. Get Pseudo Ranges.html">
       35. Get Pseudo Ranges
      </a>
     </li>
     <li class="">
      <a href="36. Solution Get Pseudo Ranges.html">
       36. Solution: Get Pseudo Ranges
      </a>
     </li>
     <li class="">
      <a href="37. Coding the Observation Model.html">
       37. Coding the Observation Model
      </a>
     </li>
     <li class="">
      <a href="38. Solution Coding the Observation Model.html">
       38. Solution: Coding the Observation Model
      </a>
     </li>
     <li class="">
      <a href="39. Coding the Full Filter.html">
       39. Coding the Full Filter
      </a>
     </li>
     <li class="">
      <a href="40. Solution Coding the Full Filter.html">
       40. Solution: Coding the Full Filter
      </a>
     </li>
     <li class="">
      <a href="41. Conclusion.html">
       41. Conclusion
      </a>
     </li>
    </ul>
    <ul class="sidebar-list list-unstyled CTAs">
     <li>
      <a class="article" href="../index.html">
       Back to Home
      </a>
     </li>
    </ul>
   </nav>
   <div id="content">
    <header class="container-fluild header">
     <div class="container">
      <div class="row">
       <div class="col-12">
        <div class="align-items-middle">
         <button class="btn btn-toggle-sidebar" id="sidebarCollapse" type="button">
          <div>
          </div>
          <div>
          </div>
          <div>
          </div>
         </button>
         <h1 style="display: inline-block">
          37. Coding the Observation Model
         </h1>
        </div>
       </div>
      </div>
     </div>
    </header>
    <main class="container">
     <div class="row">
      <div class="col-12">
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <p>
          The final individual model we will implement is the observation model.  The observation model accepts the pseudo range vector from the previous assignment, an observation vector (from vehicle sensors), and returns the observation model probability.  Ultimately, we will multiply this by the motion model probability, then normalize to produce the belief state for the current time step.
         </p>
         <p>
          The starter code below steps through each pseudo position x, calls the
          <code>
           observation_model
          </code>
          function and prints the results to standout. To complete this exercise fill in the
          <code>
           observation_model function
          </code>
          .
         </p>
         <p>
          To implement the observation_model function we must do the following for each pseudo position x:
         </p>
         <ul>
          <li>
           For each observation:
           <ul>
            <li>
             determine if a pseudo range vector exists for the current pseudo position x
            </li>
            <li>
             if the vector exists, extract and store the minimum distance, element 0 of the sorted vector, and remove that element (so we don't re-use it).  This will be passed to
             <code>
              norm_pdf
             </code>
            </li>
            <li>
             if the pseudo range vector does not exist,  pass the maximum distance to
             <code>
              norm_pdf
             </code>
            </li>
            <li>
             use
             <code>
              norm_pdf
             </code>
             to determine the observation model probability
            </li>
            <li>
             return the total probability
            </li>
           </ul>
          </li>
         </ul>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <h4>
          Start Quiz:
         </h4>
         <div>
          <div class="nav nav-tabs nav-fill" id="question-tabs" role="tablist">
           <a aria-controls="465734-main-cpp" aria-selected="true" class="nav-item nav-link active show" data-toggle="tab" href="#465734-main-cpp" id="tab-465734-main-cpp" role="tab">
            main.cpp
           </a>
           <a aria-controls="465734-helpers-h" aria-selected="false" class="nav-item nav-link" data-toggle="tab" href="#465734-helpers-h" id="tab-465734-helpers-h" role="tab">
            helpers.h
           </a>
          </div>
          <div class="tab-content" id="question-tab-contents" style="padding: 20px 0;">
           <div aria-labelledby="tab-465734-main-cpp" class="tab-pane active show" id="465734-main-cpp" role="tabpanel">
            <pre><code></code>#include &lt;algorithm&gt;
#include &lt;iostream&gt;
#include &lt;vector&gt;

#include "helpers.h"

using std::vector;

// function to get pseudo ranges
vector&lt;float&gt; pseudo_range_estimator(vector&lt;float&gt; landmark_positions, 
                                     float pseudo_position);

// observation model: calculate likelihood prob term based on landmark proximity
float observation_model(vector&lt;float&gt; landmark_positions, 
                        vector&lt;float&gt; observations, vector&lt;float&gt; pseudo_ranges,
                        float distance_max, float observation_stdev);

int main() {  
  // set observation standard deviation:
  float observation_stdev = 1.0f;

  // number of x positions on map
  int map_size = 25;

  // set distance max
  float distance_max = map_size;

  // define landmarks
  vector&lt;float&gt; landmark_positions {5, 10, 12, 20};

  // define observations
  vector&lt;float&gt; observations {5.5, 13, 15};

  // step through each pseudo position x (i)
  for (int i = 0; i &lt; map_size; ++i) {
    float pseudo_position = float(i);

    // get pseudo ranges
    vector&lt;float&gt; pseudo_ranges = pseudo_range_estimator(landmark_positions, 
                                                         pseudo_position);

    //get observation probability
    float observation_prob = observation_model(landmark_positions, observations, 
                                               pseudo_ranges, distance_max, 
                                               observation_stdev);
    //print to stdout
    std::cout &lt;&lt; observation_prob &lt;&lt; std::endl; 
  }      

  return 0;
}

// TODO: Complete the observation model function
// calculates likelihood prob term based on landmark proximity
float observation_model(vector&lt;float&gt; landmark_positions, 
                        vector&lt;float&gt; observations, vector&lt;float&gt; pseudo_ranges, 
                        float distance_max, float observation_stdev) {
  float distance_prob;
  // YOUR CODE HERE


  return distance_prob;
}

vector&lt;float&gt; pseudo_range_estimator(vector&lt;float&gt; landmark_positions, 
                                     float pseudo_position) {
  // define pseudo observation vector
  vector&lt;float&gt; pseudo_ranges;
            
  // loop over number of landmarks and estimate pseudo ranges
  for (int l=0; l&lt; landmark_positions.size(); ++l) {
    // estimate pseudo range for each single landmark 
    // and the current state position pose_i:
    float range_l = landmark_positions[l] - pseudo_position;

    // check if distances are positive: 
    if (range_l &gt; 0.0f) {
      pseudo_ranges.push_back(range_l);
    }
  }

  // sort pseudo range vector
  sort(pseudo_ranges.begin(), pseudo_ranges.end());

  return pseudo_ranges;
}</pre>
           </div>
           <div aria-labelledby="tab-465734-helpers-h" class="tab-pane" id="465734-helpers-h" role="tabpanel">
            <pre><code></code>#ifndef HELP_FUNCTIONS_H
#define HELP_FUNCTIONS_H

#include &lt;math.h&gt;

class Helpers {
 public:
  // definition of one over square root of 2*pi:
  constexpr static float STATIC_ONE_OVER_SQRT_2PI = 1/sqrt(2*M_PI);

  /**
   * normpdf(X,mu,sigma) computes the probability function at values x using the
   * normal distribution with mean mu and standard deviation std. x, mu and 
   * sigma must be scalar! The parameter std must be positive. 
   * The normal pdf is y=f(x,mu,std)= 1/(std*sqrt(2pi)) e[ -(x−mu)^2 / 2*std^2 ]
   */
  static float normpdf(float x, float mu, float std) {
    return (STATIC_ONE_OVER_SQRT_2PI/std)*exp(-0.5*pow((x-mu)/std,2));
  }
};

#endif  // HELP_FUNCTIONS_H
</pre>
           </div>
          </div>
         </div>
        </div>
       </div>
       <div class="divider">
       </div>
      </div>
      <div class="col-12">
       <p class="text-right">
        <a class="btn btn-outline-primary mt-4" href="38. Solution Coding the Observation Model.html" role="button">
         Next Concept
        </a>
       </p>
      </div>
     </div>
    </main>
    <footer class="footer">
     <div class="container">
      <div class="row">
       <div class="col-12">
        <p class="text-center">
         udacity2.0 If you need the newest courses Plase add me wechat: udacity6
        </p>
       </div>
      </div>
     </div>
    </footer>
   </div>
  </div>
  <script src="../assets/js/jquery-3.3.1.min.js">
  </script>
  <script src="../assets/js/plyr.polyfilled.min.js">
  </script>
  <script src="../assets/js/bootstrap.min.js">
  </script>
  <script src="../assets/js/jquery.mCustomScrollbar.concat.min.js">
  </script>
  <script src="../assets/js/katex.min.js">
  </script>
  <script>
   // Initialize Plyr video players
    const players = Array.from(document.querySelectorAll('video')).map(p => new Plyr(p));

    // render math equations
    let elMath = document.getElementsByClassName('mathquill');
    for (let i = 0, len = elMath.length; i < len; i += 1) {
      const el = elMath[i];

      katex.render(el.textContent, el, {
        throwOnError: false
      });
    }

    // this hack will make sure Bootstrap tabs work when using Handlebars
    if ($('#question-tabs').length && $('#user-answer-tabs').length) {
      $("#question-tabs a.nav-link").on('click', function () {
        $("#question-tab-contents .tab-pane").hide();
        $($(this).attr("href")).show();
      });
      $("#user-answer-tabs a.nav-link").on('click', function () {
        $("#user-answer-tab-contents .tab-pane").hide();
        $($(this).attr("href")).show();
      });
    } else {
      $("a.nav-link").on('click', function () {
        $(".tab-pane").hide();
        $($(this).attr("href")).show();
      });
    }

    // side bar events
    $(document).ready(function () {
      $("#sidebar").mCustomScrollbar({
        theme: "minimal"
      });

      $('#sidebarCollapse').on('click', function () {
        $('#sidebar, #content').toggleClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
      });

      // scroll to first video on page loading
      if ($('video').length) {
        $('html,body').animate({ scrollTop: $('div.plyr').prev().offset().top});
      }

      // auto play first video: this may not work with chrome/safari due to autoplay policy
      if (players && players.length > 0) {
        players[0].play();
      }

      // scroll sidebar to current concept
      const currentInSideBar = $( "ul.sidebar-list.components li a:contains('37. Coding the Observation Model')" )
      currentInSideBar.css( "text-decoration", "underline" );
      $("#sidebar").mCustomScrollbar('scrollTo', currentInSideBar);
    });
  </script>
 </body>
</html>
